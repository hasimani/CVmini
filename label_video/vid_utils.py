import cv2 

class play_vid:
    def __init__(self,path,labels):
        col_dict = {'green':(0,225,0), 'red': (225,0,0)}
        vid_capture = cv2.VideoCapture(path)
        if (vid_capture.isOpened() == False):
            print("Error opening the video file")
        # Read fps and frame count
        else:
            # Get frame rate information
            
            # Get frame count
            frame_count = vid_capture.get(7)
            # Get frame length and height
            self.len = vid_capture.get(3)
            self.hei = vid_capture.get(4)
        
        if len(labels) != frame_count:
            raise Exception("The labels and video are not compatible")
        cv2.startWindowThread()
        cv2.namedWindow('Frame', cv2.WND_PROP_AUTOSIZE)
        size = (int(self.len),int(self.hei))
        result = cv2.VideoWriter(f'{path[:-4]}_out.avi',cv2.VideoWriter_fourcc(*'MJPG'),10, size)
        i = 0
        while(vid_capture.isOpened()):
            # vid_capture.read() methods returns a tuple, first element is a bool 
            # and the second is the frame
            ret, frame = vid_capture.read()
            if ret == True:
                self.text_gen(labels[i],frame)
                cv2.imshow('Frame',frame)
                result.write(frame)
                i += 1
                # 25 is in milliseconds, try to increase the value, say 50 and observe
                key = cv2.waitKey(25)

                if key == ord('q'):
                    break
            else:
                break

        # Release the video capture object
        vid_capture.release()
        cv2.destroyAllWindows()       

    def coloring(self,conf):
        return (0,225,0) if conf > 0.8 else (0,0,225)
        
    def text_gen(self,content,name):
        for i,obj in enumerate(content):
            text = f"{obj[0]}: {obj[1]:.3f}"
            org = (int(0.05 * self.len), int(self.hei * (0.05*(i+1))))
            
            cv2.putText(name, text, org, fontFace = cv2.FONT_HERSHEY_COMPLEX, fontScale = 0.8, color = self.coloring(obj[1]))


if __name__ == "__main__":

    lisest = [[['snail', 0.9591545], ['slug', 0.006195912], ['conch', 0.003460274]], [['snail', 0.95789045], ['slug', 0.005815628], ['conch', 0.0043063695]], [['snail', 0.9546398], ['slug', 0.0063999067], ['conch', 0.004152532]], [['snail', 0.9555781], ['slug', 0.0063577504], ['conch', 0.0039808783]], [['snail', 0.95782727], ['slug', 0.006113971], ['conch', 0.0039087287]], [['snail', 0.9580271], ['slug', 0.0065091993], ['conch', 0.0038097582]], [['snail', 0.9440235], ['slug', 0.006980323], ['conch', 0.0050870883]], [['snail', 0.9411397], ['slug', 0.0069956337], ['conch', 0.005565193]], [['snail', 0.9393226], ['slug', 0.007289687], ['conch', 0.0058797393]], [['snail', 0.9405755], ['slug', 0.0068248506], ['conch', 0.0057600336]], [['snail', 0.9398892], ['conch', 0.0065155057], ['slug', 0.006037538]], [['snail', 0.948309], ['slug', 0.007324886], ['conch', 0.004067018]], [['snail', 0.95348936], ['slug', 0.0058651613], ['conch', 0.00543683]], [['snail', 0.9519679], ['slug', 0.0058238846], ['conch', 0.0058200206]], [['snail', 0.9504611], ['conch', 0.0070445286], ['slug', 0.005596149]], [['snail', 0.9500234], ['conch', 0.0065907626], ['slug', 0.005548383]], [['snail', 0.94804054], ['conch', 0.0068658143], ['slug', 0.0056196437]], [['snail', 0.93874913], ['conch', 0.007505961], ['slug', 0.005043897]], [['snail', 0.9312955], ['conch', 0.0085170455], ['slug', 0.005453374]], [['snail', 0.939129], ['conch', 0.0068959626], ['slug', 0.0053028185]], [['snail', 0.94542813], ['conch', 0.006020265], ['slug', 0.0053628185]], [['snail', 0.9527232], ['slug', 0.0051197675], ['conch', 0.0049203984]], [['snail', 0.9468159], ['conch', 0.0057492605], ['slug', 0.004615651]], [['snail', 0.9429496], ['conch', 0.005586149], ['slug', 0.004863904]], [['snail', 0.9398952], ['conch', 0.0057543167], ['slug', 0.005531538]], [['snail', 0.9410897], ['slug', 0.0050593014], ['conch', 0.0050433227]], [['snail', 0.93693775], ['conch', 0.005560291], ['slug', 0.005272054]], [['snail', 0.9390228], ['conch', 0.0050911224], ['slug', 0.005071939]], [['snail', 0.94370395], ['conch', 0.0051671565], ['slug', 0.0044461973]], [['snail', 0.95638555], ['slug', 0.004670682], ['conch', 0.004603386]], [['snail', 0.9309412], ['conch', 0.010560587], ['slug', 0.007479213]], [['snail', 0.9209865], ['conch', 0.012548561], ['slug', 0.006777681]], [['snail', 0.9309908], ['conch', 0.009793822], ['slug', 0.007079876]], [['snail', 0.923589], ['conch', 0.011737447], ['slug', 0.0072324765]], [['snail', 0.93378127], ['conch', 0.009685557], ['slug', 0.0071657104]], [['snail', 0.9313835], ['conch', 0.010020351], ['slug', 0.007063553]], [['snail', 0.9356535], ['slug', 0.0076892423], ['conch', 0.0076220767]], [['snail', 0.93828976], ['slug', 0.007498136], ['conch', 0.007166391]], [['snail', 0.93354213], ['slug', 0.0077526285], ['conch', 0.0072014607]], [['snail', 0.93492466], ['conch', 0.0076310905], ['slug', 0.007428566]], [['snail', 0.9315824], ['conch', 0.008835691], ['slug', 0.0072233127]], [['snail', 0.9332839], ['conch', 0.009885987], ['slug', 0.0066779335]], [['snail', 0.92425483], ['conch', 0.010675716], ['slug', 0.0069281966]], [['snail', 0.9262564], ['conch', 0.010819392], ['slug', 0.006983966]], [['snail', 0.9243487], ['conch', 0.0117923375], ['slug', 0.006639332]], [['snail', 0.92280203], ['conch', 0.011384145], ['slug', 0.0067675468]], [['snail', 0.9208907], ['conch', 0.012319506], ['slug', 0.006683996]], [['snail', 0.9143597], ['conch', 0.011798078], ['slug', 0.007303686]], [['snail', 0.92362666], ['conch', 0.008695913], ['slug', 0.007176441]], [['snail', 0.93888205], ['conch', 0.0074769226], ['slug', 0.006500736]], [['snail', 0.9374262], ['conch', 0.009053134], ['slug', 0.006773462]], [['snail', 0.9290243], ['conch', 0.011746336], ['slug', 0.0068647363]], [['snail', 0.92937183], ['conch', 0.011768046], ['slug', 0.0069548935]], [['snail', 0.9223943], ['conch', 0.012752874], ['slug', 0.0070661507]], [['snail', 0.8838392], ['conch', 0.014956606], ['slug', 0.0074376306]], [['snail', 0.88786376], ['conch', 0.015356828], ['slug', 0.006938774]], [['snail', 0.878917], ['conch', 0.017908653], ['slug', 0.0067524477]], [['snail', 0.9027492], ['conch', 0.012711289], ['slug', 0.0064908643]], [['snail', 0.88921547], ['conch', 0.01621699], ['slug', 0.006847408]], [['snail', 0.9259604], ['conch', 0.012385751], ['slug', 0.005126168]], [['snail', 0.9340264], ['conch', 0.010237896], ['slug', 0.006929616]], [['snail', 0.923472], ['conch', 0.012104113], ['slug', 0.007358784]], [['snail', 0.9240046], ['conch', 0.011009397], ['slug', 0.0074372315]], [['snail', 0.91840035], ['conch', 0.012314068], ['slug', 0.007978101]], [['snail', 0.9192029], ['conch', 0.010623674], ['slug', 0.008469434]], [['snail', 0.9112832], ['conch', 0.011727864], ['slug', 0.008730914]], [['snail', 0.9028611], ['conch', 0.010320289], ['slug', 0.0094898585]], [['snail', 0.91447616], ['conch', 0.01160146], ['slug', 0.0081391595]], [['snail', 0.9114756], ['conch', 0.01175935], ['slug', 0.0068609472]], [['snail', 0.9200089], ['conch', 0.010645281], ['slug', 0.006391306]], [['snail', 0.92073554], ['conch', 0.0111642135], ['slug', 0.006264259]], [['snail', 0.9063464], ['conch', 0.011927988], ['slug', 0.0072792955]], [['snail', 0.91942215], ['conch', 0.013538094], ['slug', 0.006793655]], [['snail', 0.9168517], ['conch', 0.014737086], ['slug', 0.0067291055]], [['snail', 0.9141575], ['conch', 0.015360544], ['slug', 0.0069955923]], [['snail', 0.92345023], ['conch', 0.012043481], ['slug', 0.0068645184]], [['snail', 0.9273254], ['conch', 0.012474113], ['slug', 0.0063175014]], [['snail', 0.92359114], ['conch', 0.013073436], ['slug', 0.0062706247]], [['snail', 0.92817426], ['conch', 0.012020944], ['slug', 0.006827747]], [['snail', 0.93061095], ['conch', 0.011516712], ['slug', 0.0065833144]], [['snail', 0.93358827], ['conch', 0.010576887], ['slug', 0.0067008035]], [['snail', 0.93623745], ['conch', 0.010261901], ['slug', 0.006419694]], [['snail', 0.9370062], ['conch', 0.009888219], ['slug', 0.0067264386]], [['snail', 0.9353689], ['conch', 0.008611066], ['slug', 0.0076221745]], [['snail', 0.9173175], ['conch', 0.011529849], ['slug', 0.008086382]], [['snail', 0.9168541], ['conch', 0.011187372], ['slug', 0.008163088]], [['snail', 0.9137953], ['conch', 0.011376678], ['slug', 0.008438085]], [['snail', 0.9150581], ['conch', 0.01052379], ['slug', 0.008096163]], [['snail', 0.91926134], ['conch', 0.00824456], ['slug', 0.0076219975]], [['snail', 0.91922426], ['conch', 0.0080692405], ['slug', 0.0079599]], [['snail', 0.91882074], ['conch', 0.012772107], ['slug', 0.007457922]], [['snail', 0.93311876], ['conch', 0.010645306], ['slug', 0.0072111017]], [['snail', 0.93024975], ['conch', 0.009103728], ['slug', 0.007604644]], [['snail', 0.91526663], ['conch', 0.011566727], ['slug', 0.008007203]], [['snail', 0.9199777], ['conch', 0.009855463], ['slug', 0.0076831537]], [['snail', 0.91072434], ['conch', 0.014490796], ['slug', 0.008612205]], [['snail', 0.92868334], ['slug', 0.010947354], ['conch', 0.006441273]], [['snail', 0.93079764], ['slug', 0.010617813], ['conch', 0.006506749]], [['snail', 0.90732336], ['slug', 0.011463496], ['conch', 0.0079394905]], [['snail', 0.9311546], ['slug', 0.009995325], ['conch', 0.0062925746]], [['snail', 0.9311426], ['slug', 0.009401606], ['conch', 0.00631589]], [['snail', 0.931469], ['slug', 0.009267697], ['conch', 0.0065389536]], [['snail', 0.94965637], ['slug', 0.009539129], ['conch', 0.0045962404]], [['snail', 0.95512503], ['slug', 0.0077698035], ['conch', 0.0044959984]], [['snail', 0.9597738], ['slug', 0.0070272572], ['conch', 0.0044961106]], [['snail', 0.9472814], ['slug', 0.008646908], ['conch', 0.0043173395]], [['snail', 0.95651305], ['slug', 0.007022029], ['conch', 0.004358443]], [['snail', 0.9603423], ['slug', 0.006458559], ['conch', 0.003538597]], [['snail', 0.94100267], ['slug', 0.009618146], ['conch', 0.0045009777]], [['snail', 0.93221307], ['slug', 0.009690118], ['conch', 0.0053886506]], [['snail', 0.9414279], ['slug', 0.008440542], ['conch', 0.0051440448]], [['snail', 0.95082384], ['slug', 0.006322949], ['conch', 0.0055110734]], [['snail', 0.95029044], ['slug', 0.006603035], ['conch', 0.005591165]], [['snail', 0.95204777], ['conch', 0.0070269057], ['slug', 0.0057026464]], [['snail', 0.9338038], ['conch', 0.010702243], ['slug', 0.004825142]], [['snail', 0.9188974], ['conch', 0.012906612], ['slug', 0.0056271814]], [['snail', 0.93378013], ['conch', 0.012891401], ['slug', 0.005656017]], [['snail', 0.9248482], ['conch', 0.017841354], ['slug', 0.004833836]], [['snail', 0.9328143], ['conch', 0.013776947], ['slug', 0.0049224887]], [['snail', 0.9321006], ['conch', 0.014160909], ['slug', 0.0052590505]], [['snail', 0.9396053], ['slug', 0.006241354], ['conch', 0.00557163]], [['snail', 0.93000627], ['conch', 0.007553532], ['slug', 0.0070308927]], [['snail', 0.93846506], ['slug', 0.00694], ['conch', 0.0054448694]], [['snail', 0.9440339], ['slug', 0.0063311746], ['conch', 0.005956412]], [['snail', 0.9290111], ['slug', 0.0075413305], ['conch', 0.0072182533]], [['snail', 0.9313615], ['conch', 0.007236277], ['slug', 0.007085752]]]
    play_vid('test/hlz.mp4',lisest)

